#define _GNU_SOURCE
#include <alloca.h>
#include <stddef.h>

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>


static char huge0 [ 0x7fffffff ];       // size_t is unsigned, so this is the most we can put in a single char[]
static char huge1 [ 0x77800000 ];       // past about this size it begins to segfault unpredictably - sometimes on startup, sometimes when I cat /proc/$(pidof s)/maps

void catmaps() {
    char* cmd;
    asprintf(&cmd, "cat /proc/%u/maps", getpid());
    printf("\n%s\n", cmd);
    fflush(stdout);
    system(cmd);
    fflush(stdout);
    printf("\n");
}

int main(int ac, char** av) {
    volatile char stk = 0;
    static char* top = &huge1[sizeof(huge1)];
    volatile ptrdiff_t diff = &stk - top;
    char *p;

    printf("Top of data:      %08p\n", top);
    printf("Bottom of stack:  %08p\n", &stk);
    printf("data <-> stack:   0x%08tx\n", diff);

    catmaps();

    while (1) ;
}

