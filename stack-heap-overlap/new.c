#include <stdio.h>
#include <limits.h>
#include <stdlib.h>
#include <stddef.h>

#include <unistd.h>
#include <string.h>

#define DS_SIZE 128 * 1024 * 1024
#define PADDING 0x10000


static int im_in_the_data_section[DS_SIZE] = {1};
static int *next = NULL;

int recurse(int t) {

    int z = 0;
    recurse (z + 1);

    return 0;
}

void cat_proc_self_maps() {
    char *cmd;
    asprintf (&cmd, "cat /proc/%u/maps", getpid());
    system(cmd);
}

int main(void) {

	ptrdiff_t diff;
        char *cmd, *n;

        int *heap_start;

	int var_on_stack = 1;

	printf("BIG DATA SECTION: %p\n",(void*)&im_in_the_data_section);
	printf("NEXT VAR: %p\n", (void*)&next);

	printf("VAR ON STACK: %p\n", (void*)&var_on_stack);

        heap_start = malloc(1);

	diff =  heap_start - &var_on_stack;

	printf("DIFF: %#p\n", (void*)diff);

        printf("== Before::\n");
        cat_proc_self_maps();
        printf("== After:\n");

        n = malloc(PADDING);

        cat_proc_self_maps();

        printf("DONE\n");


	return 0;

}
